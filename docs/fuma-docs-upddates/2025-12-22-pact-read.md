# Pact Docs Update - 2025-12-22 (pact read)

## Summary

New `pact read` command for reverse sync - scan your local development environment and import detected tools, configs, and settings into your pact.json.

---

## New Command: `pact read`

### Overview

`pact read` is the inverse of `pact sync`. Instead of applying your pact.json to your machine, it detects what's already on your machine and lets you import it into pact.json.

This enables:
- **Bootstrap from existing setup** - New pact users can import their current environment
- **Drift detection** - See what's different between your local machine and pact.json
- **Config file tracking** - Discover and copy config files (.zshrc, nvim, vscode settings, etc.)

### Usage

```bash
# Interactive scan and import
pact read

# Show what differs from pact.json (no import)
pact read --diff

# Output detected config as JSON
pact read --json

# Import everything without prompts
pact read -y

# Preview without making changes
pact read --dry-run

# Only scan specific modules
pact read shell git editor
```

### Flags

| Flag | Description |
|------|-------------|
| `--diff` | Only show differences from pact.json |
| `--json` | Output detected config as JSON (for scripting) |
| `-y, --yes` | Import all detected items without prompting |
| `--dry-run` | Preview changes without modifying anything |

---

## What Gets Detected

| Category | Detection Method |
|----------|-----------------|
| **CLI Tools** | Scans PATH for known tools (node, bun, go, git, gh, lazygit, ripgrep, jq, curl, etc.) |
| **Shell Prompt** | Detects oh-my-posh/starship, parses theme from shell config |
| **Shell Tools** | Detects zoxide, fzf, direnv, nvm, rbenv, pyenv |
| **Git Config** | Reads `git config --global` for user.name, email, defaultBranch, LFS status |
| **Editors** | Checks for zed, cursor, vscode, neovim, vim, etc. via PATH and $EDITOR |
| **LLM/AI** | Detects API keys (ANTHROPIC_API_KEY, etc.), ollama models, coding agents (claude, opencode) |
| **Secrets** | Regex-based env var scanning for API keys and tokens |
| **Config Files** | Discovers .zshrc, .gitconfig, nvim/, vscode settings.json, etc. |

---

## Interactive TUI

`pact read` features a two-stage hierarchical picker:

### Stage 1: Module Selection
```
Select modules to import:

  > [x] cli         (12 new tools)
    [x] shell       (1 config file, 2 tools)
    [ ] git         (no changes)
    [x] editor      (2 new)
    [x] secrets     (3 detected)

  ↑/↓: navigate  space: toggle  enter: continue  a: all  q: quit
```

### Stage 2: Item Selection (per module)
```
Importing from: cli

  > [x] ripgrep     not in pact.json
    [x] fzf         not in pact.json
    [ ] httpie      not in pact.json

  ↑/↓: navigate  space: toggle  enter: confirm  b: back  a: all
```

---

## Drift Detection

Running `pact read --diff` shows:
- **● Synced** - Items in both local environment and pact.json
- **○ Local Only** - Items on your machine but not in pact.json (can be imported)
- **✗ Pact Only** - Items in pact.json but not installed locally

Example output:
```
Detected Configuration:
────────────────────────────────────────────────────────────

  cli
    ● node  ✓
    ● bun  ✓
    ○ ripgrep ← LOCAL ONLY
    ✗ deno ← PACT ONLY (not installed)

  shell
    ● oh-my-posh (capr4n) ✓
    ● zoxide  ✓

  secrets
    ○ ANTHROPIC_API_KEY ← LOCAL ONLY
    ○ OPENAI_API_KEY ← LOCAL ONLY

────────────────────────────────────────────────────────────
Legend: ● synced  ○ can import  ✗ missing locally
```

---

## Config File Discovery

`pact read` discovers and can copy these config files to your pact repo:

| Config | Paths Checked |
|--------|--------------|
| Shell (zsh) | `~/.zshrc`, `~/.zprofile` |
| Shell (bash) | `~/.bashrc`, `~/.profile` |
| Shell (PowerShell) | `~/Documents/PowerShell/Microsoft.PowerShell_profile.ps1` |
| Git | `~/.gitconfig`, `~/.gitignore_global` |
| Neovim | `~/.config/nvim/` (directory) |
| VS Code | Platform-specific settings.json, keybindings.json |
| Cursor | Platform-specific settings.json |
| Zed | `~/.config/zed/settings.json` |
| Lazygit | `~/.config/lazygit/config.yml` |
| Starship | `~/.config/starship.toml` |

Files are copied to `.pact/<module>/<name>` (e.g., `.pact/shell/zshrc`).

---

## GitHub Init Prompt

If pact is not initialized, `pact read` prompts to connect GitHub:

```
$ pact read

Pact is not initialized.
Would you like to connect GitHub and create your pact repo? [Y/n]: y

Authenticating with GitHub...
Please visit: https://github.com/login/device
And enter code: ABCD-1234

✓ Authenticated as your-username
✓ Created my-pact repo
✓ Cloned repo to ./.pact/

Now scanning your development environment...
```

---

## Secrets Handling

Detected secrets (API keys, tokens) are:
1. Added to the `secrets` array in pact.json (just the names)
2. Stored in your OS keychain (the actual values)

The values are **never** stored in pact.json or your GitHub repo.

---

## Example Workflow

### New User Bootstrap
```bash
# Install pact on a fresh machine
brew install cloudboy-jh/tap/pact

# Scan and import your existing setup
cd ~/projects
pact read

# Select what to import...
# ✓ Updated pact.json
# ✓ Copied 3 config files to .pact/
# ✓ Added 2 secrets to keychain

# Push to GitHub
pact push -m "Initial import from macbook"
```

### Drift Check
```bash
# See what's different without changing anything
pact read --diff

# Found 5 new items not in pact.json
# Found 2 items in pact.json not installed locally
```

### CI/Scripting
```bash
# Get machine state as JSON
pact read --json > detected.json

# Auto-import everything
pact read -y
```

---

## Updated Commands Table

| Command | Description |
|---------|-------------|
| `pact` | Interactive status with quick actions (s/e/q) |
| `pact init` | Authenticate with GitHub + setup your pact repo |
| `pact sync` | Interactive module picker - select which modules to apply |
| `pact sync all` | Apply everything |
| `pact sync <module>` | Apply specific module |
| **`pact read`** | **Scan local environment and import to pact** |
| **`pact read --diff`** | **Show drift between local and pact.json** |
| **`pact read --json`** | **Output detected config as JSON** |
| `pact edit` | Edit pact.json in $EDITOR |
| `pact edit web` | Open web editor in browser |
| `pact push` | Commit and push local changes |
| `pact status` | Show status (non-interactive) |
| `pact secret set <name>` | Store a secret in OS keychain |
| `pact secret list` | List secrets and their status |
| `pact reset` | Remove all symlinks (keeps .pact/) |
| `pact nuke` | Full cleanup (symlinks + .pact/ + token) |

---

## Cross-Platform Support

Detection works on all platforms:

| OS | Package Detection | Config Paths |
|----|------------------|--------------|
| macOS | Homebrew packages | `~/.config/`, `~/Library/Application Support/` |
| Linux | apt/dnf/pacman packages | `~/.config/` |
| Windows | winget/scoop/choco packages | `~/AppData/` |
