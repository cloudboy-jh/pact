import { jsx as _jsx } from "react/jsx-runtime";
import { render } from "ink";
import { FullScreenBox } from "./FullScreenBox.js";
async function write(content) {
    return new Promise((resolve, reject) => {
        process.stdout.write(content, (error) => {
            if (error)
                reject(error);
            else
                resolve();
        });
    });
}
async function cleanUpOnExit(instance) {
    await instance.waitUntilExit();
    await write("\x1b[?1049l"); // exit alternate buffer
}
export const withFullScreen = (node, options) => {
    const instance = render(null, options);
    const exitPromise = cleanUpOnExit(instance);
    function waitUntilExit() {
        return exitPromise;
    }
    return {
        instance: instance,
        start: async () => {
            await write("\x1b[?1049h"); // enter alternate buffer
            instance.rerender(_jsx(FullScreenBox, { children: node }));
        },
        waitUntilExit,
    };
};
